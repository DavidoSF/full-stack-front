<div class="product-details-page">
  <button class="back-btn" (click)="goBack()">← Back to Products</button>

  <div class="loading" *ngIf="loading">
    <p>Loading product details...</p>
  </div>

  <div class="error" *ngIf="error">
    <p>{{ error }}</p>
  </div>

  <div class="product-details" *ngIf="product && !loading">
    <div class="product-image">
      <img src="assets/placeholder.png" [alt]="product.name" />
      <div
        class="promo-badge"
        *ngIf="product.promo"
        [class.promo-percentage]="product.promo.type === 'percentage'"
        [class.promo-shipping]="product.promo.type === 'free_shipping'"
      >
        <mat-icon class="promo-icon">{{
          product.promo.type === 'percentage' ? 'local_offer' : 'local_shipping'
        }}</mat-icon>
        <span>{{ product.promo.label }}</span>
      </div>
    </div>

    <div class="product-info">
      <h1>{{ product.name }}</h1>

      <div class="product-rating">
        <span class="rating-stars"> ⭐ {{ product.avg_rating | number: '1.1-1' }} </span>
        <span class="rating-count">({{ product.ratings_count }} reviews)</span>
        <button class="view-ratings-btn" (click)="viewRating()">View Ratings</button>
      </div>

      <div class="product-price">
        <span class="price">{{ product.price | currency: 'EUR' }}</span>
      </div>

      <div class="product-stock" [ngClass]="getStockStatus().cssClass">
        <span>{{ getStockStatus().message }}</span>
      </div>

      <div class="product-category"><strong>Category:</strong> {{ product.category }}</div>

      <div class="product-description">
        <h3>Description</h3>
        <p>{{ product.description }}</p>
      </div>

      <div class="product-actions">
        <div class="quantity-selector">
          <label>Quantity:</label>
          <div class="quantity-controls">
            <button (click)="decreaseQuantity()" [disabled]="quantity <= 1">-</button>
            <span class="quantity-display">{{ quantity }}</span>
            <button
              (click)="increaseQuantity()"
              [disabled]="product.stock > 0 && quantity >= product.stock"
            >
              +
            </button>
          </div>
        </div>

        <div class="action-buttons">
          <button
            class="add-to-cart-btn"
            (click)="addToCart()"
            [disabled]="!(canAddToCart$ | async)"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="9" cy="21" r="1"></circle>
              <circle cx="20" cy="21" r="1"></circle>
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
            </svg>
            {{ product.stock === 0 ? 'Out of Stock' : 'Add to Cart' }}
          </button>

          <button
            class="wishlist-btn"
            *ngIf="isInWishlist$ | async as isInWishlist; else notInWishlist"
            (click)="toggleWishlist(true)"
            class="wishlist-btn in-wishlist"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="currentColor"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"
              ></path>
            </svg>
            Remove from Wishlist
          </button>
          <ng-template #notInWishlist>
            <button class="wishlist-btn" (click)="toggleWishlist(false)">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"
                ></path>
              </svg>
              Add to Wishlist
            </button>
          </ng-template>
        </div>
      </div>

      <div class="product-meta">
        <p><strong>Product ID:</strong> {{ product.id }}</p>
        <p><strong>Added:</strong> {{ product.created_at | date: 'mediumDate' }}</p>
      </div>
    </div>
  </div>
</div>
